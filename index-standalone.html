<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Wallet Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 800px;
            width: 100%;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            color: #856404;
        }

        .warning strong {
            display: block;
            margin-bottom: 5px;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            flex: 1;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .wallet-info {
            display: none;
            margin-top: 20px;
        }

        .wallet-info.show {
            display: block;
        }

        .info-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .info-section h3 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-content {
            background: white;
            padding: 15px;
            border-radius: 5px;
            word-break: break-all;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            color: #212529;
            border: 1px solid #dee2e6;
        }

        .mnemonic-words {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .mnemonic-word {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #dee2e6;
            text-align: center;
        }

        .word-number {
            font-size: 0.7em;
            color: #6c757d;
            display: block;
            margin-bottom: 5px;
        }

        .copy-btn {
            background: #28a745;
            color: white;
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            background: #218838;
        }

        .balance-section {
            background: #d1ecf1;
            border: 2px solid #bee5eb;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .balance-amount {
            font-size: 1.5em;
            font-weight: bold;
            color: #0c5460;
            margin-top: 10px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .trustwallet-info {
            background: #e7f3ff;
            border: 2px solid #2196F3;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .trustwallet-info h4 {
            color: #0d47a1;
            margin-bottom: 10px;
        }

        .trustwallet-info ol {
            margin-left: 20px;
            color: #1565c0;
        }

        .trustwallet-info li {
            margin-bottom: 8px;
        }

        .error {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            display: none;
        }

        .error.show {
            display: block;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 1.5em;
            }

            .btn-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîê Bitcoin Wallet Generator</h1>
        <p class="subtitle">Generate secure Bitcoin wallet addresses with backup codes</p>

        <div class="warning">
            <strong>‚ö†Ô∏è Security Warning:</strong>
            This generator creates real Bitcoin wallet addresses. Keep your backup phrase (seed words) secure and private. Anyone with access to your backup phrase can access your funds. Never share it with anyone!
        </div>

        <div class="btn-group">
            <button class="btn-primary" onclick="generateWallet()">Generate New Wallet</button>
            <button class="btn-secondary" onclick="checkBalance()">Check Balance</button>
        </div>

        <div id="walletInfo" class="wallet-info">
            <div class="info-section">
                <h3>üîë Backup Phrase (Mnemonic)</h3>
                <div id="mnemonicDisplay" class="mnemonic-words"></div>
                <button class="copy-btn" onclick="copyToClipboard('mnemonic')">üìã Copy Backup Phrase</button>
            </div>

            <div class="info-section">
                <h3>üìç Bitcoin Address</h3>
                <div id="addressDisplay" class="info-content"></div>
                <button class="copy-btn" onclick="copyToClipboard('address')">üìã Copy Address</button>
            </div>

            <div class="info-section">
                <h3>üîê Private Key (WIF)</h3>
                <div id="privateKeyDisplay" class="info-content"></div>
                <button class="copy-btn" onclick="copyToClipboard('privateKey')">üìã Copy Private Key</button>
            </div>

            <div class="balance-section">
                <h3>üí∞ Wallet Balance</h3>
                <div id="balanceDisplay" class="balance-amount">Click "Check Balance" to view</div>
            </div>

            <div class="trustwallet-info">
                <h4>üì± How to Import into TrustWallet:</h4>
                <ol>
                    <li>Open TrustWallet app on your mobile device</li>
                    <li>Tap "Create a new wallet" or "I already have a wallet"</li>
                    <li>Select "Import using Recovery Phrase"</li>
                    <li>Enter your 12-word backup phrase (in order)</li>
                    <li>Your Bitcoin wallet will be restored with the same address</li>
                </ol>
            </div>
        </div>

        <div id="errorMessage" class="error"></div>
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading" style="margin: 0 auto 20px;"></div>
            <p>Loading Bitcoin libraries...</p>
        </div>
    </div>

    <!-- Include Bitcoin libraries from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/bip39@3.1.0/dist/bip39.min.js" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bitcoinjs-lib@6.1.3/dist/bitcoinjs-lib.min.js" crossorigin="anonymous"></script>

    <script>
        let currentWallet = {
            mnemonic: '',
            address: '',
            privateKey: '',
            path: "m/44'/0'/0'/0/0" // BIP44 standard path for Bitcoin
        };

        let librariesLoaded = false;

        // Wait for libraries to load
        function waitForLibraries() {
            return new Promise((resolve) => {
                const checkInterval = setInterval(() => {
                    if (typeof bip39 !== 'undefined' && typeof bitcoinjs !== 'undefined') {
                        clearInterval(checkInterval);
                        librariesLoaded = true;
                        hideLoading();
                        resolve();
                    }
                }, 100);

                // Timeout after 10 seconds
                setTimeout(() => {
                    if (!librariesLoaded) {
                        clearInterval(checkInterval);
                        showError('Failed to load Bitcoin libraries. Please check your internet connection and reload the page.');
                        hideLoading();
                    }
                }, 10000);
            });
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        async function generateWallet() {
            if (!librariesLoaded) {
                showError('Bitcoin libraries are still loading. Please wait...');
                return;
            }

            try {
                // Generate a 12-word mnemonic (128 bits of entropy)
                const mnemonic = bip39.generateMnemonic();
                
                // Generate seed from mnemonic
                const seed = bip39.mnemonicToSeedSync(mnemonic);
                
                // Create Bitcoin wallet
                const bitcoin = bitcoinjs.bitcoin;
                const network = bitcoin.networks.bitcoin; // Mainnet
                
                // Create root key from seed
                const root = bitcoin.bip32.fromSeed(seed, network);
                
                // Derive key using BIP44 path
                const path = "m/44'/0'/0'/0/0";
                const child = root.derivePath(path);
                
                // Generate P2PKH address (legacy address starting with 1)
                const { address } = bitcoin.payments.p2pkh({
                    pubkey: child.publicKey,
                    network: network
                });
                
                // Get WIF private key
                const privateKey = child.toWIF();
                
                // Store wallet info
                currentWallet = {
                    mnemonic: mnemonic,
                    address: address,
                    privateKey: privateKey,
                    path: path
                };
                
                // Display wallet info
                displayWallet();
                
                // Hide error if any
                hideError();
            } catch (error) {
                showError('Error generating wallet: ' + error.message);
                console.error('Wallet generation error:', error);
            }
        }

        function displayWallet() {
            // Display mnemonic as numbered words
            const words = currentWallet.mnemonic.split(' ');
            const mnemonicHTML = words.map((word, index) => 
                `<div class="mnemonic-word">
                    <span class="word-number">${index + 1}</span>
                    <strong>${word}</strong>
                </div>`
            ).join('');
            document.getElementById('mnemonicDisplay').innerHTML = mnemonicHTML;
            
            // Display address
            document.getElementById('addressDisplay').textContent = currentWallet.address;
            
            // Display private key
            document.getElementById('privateKeyDisplay').textContent = currentWallet.privateKey;
            
            // Reset balance display
            document.getElementById('balanceDisplay').textContent = 'Click "Check Balance" to view';
            
            // Show wallet info
            document.getElementById('walletInfo').classList.add('show');
        }

        async function checkBalance() {
            if (!currentWallet.address) {
                showError('Please generate a wallet first!');
                return;
            }

            const balanceDisplay = document.getElementById('balanceDisplay');
            balanceDisplay.innerHTML = 'Checking balance<span class="loading"></span>';
            hideError();

            try {
                // Use blockchain.info API to check balance
                const response = await fetch(`https://blockchain.info/q/addressbalance/${currentWallet.address}`);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch balance from blockchain');
                }
                
                const satoshis = await response.text();
                const btc = parseInt(satoshis) / 100000000; // Convert satoshis to BTC
                
                balanceDisplay.innerHTML = `
                    <strong>${btc.toFixed(8)} BTC</strong><br>
                    <small>(${satoshis} satoshis)</small>
                `;
                
                // Also try to get USD value
                try {
                    const priceResponse = await fetch('https://blockchain.info/ticker');
                    const priceData = await priceResponse.json();
                    const usdValue = (btc * priceData.USD.last).toFixed(2);
                    balanceDisplay.innerHTML += `<br><small>‚âà $${usdValue} USD</small>`;
                } catch (e) {
                    console.log('Could not fetch USD price:', e);
                }
                
            } catch (error) {
                showError('Error checking balance: ' + error.message);
                balanceDisplay.textContent = 'Error fetching balance';
                console.error('Balance check error:', error);
            }
        }

        function copyToClipboard(type) {
            let textToCopy = '';
            
            switch(type) {
                case 'mnemonic':
                    textToCopy = currentWallet.mnemonic;
                    break;
                case 'address':
                    textToCopy = currentWallet.address;
                    break;
                case 'privateKey':
                    textToCopy = currentWallet.privateKey;
                    break;
            }
            
            if (!textToCopy) {
                showError('Nothing to copy!');
                return;
            }
            
            // Copy to clipboard
            navigator.clipboard.writeText(textToCopy).then(() => {
                // Show temporary success message
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úì Copied!';
                btn.style.background = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(err => {
                showError('Failed to copy to clipboard');
                console.error('Copy error:', err);
            });
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        function hideError() {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.classList.remove('show');
        }

        // Initialize on load
        window.addEventListener('load', async () => {
            console.log('Bitcoin Wallet Generator initializing...');
            showLoading();
            await waitForLibraries();
            console.log('Libraries loaded:', {
                bip39: typeof bip39 !== 'undefined',
                bitcoinjs: typeof bitcoinjs !== 'undefined'
            });
        });
    </script>
</body>
</html>
